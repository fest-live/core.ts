//
const existsMap = new WeakMap();
//
class WeakRefProxyHandler {
    _deref(target) { return (target instanceof WeakRef || typeof target?.deref == "function") ? (target?.deref?.()) : target; } // @ts-ignore
    //
    get(tg, prop, _receiver) {
        const obj = this._deref(tg), value = obj?.[prop];
        // libraries specific (LUR.E/object.ts)
        if ((prop == "element" || prop == "value") && obj && (value == null || !(prop in obj))) {
            return obj;
        }
        // wrap-away deref from side-effects
        if (prop == "deref") {
            return () => this._deref(tg);
        }
        ;
        // if function, workaround callable
        if (typeof value == 'function') {
            return (...args) => {
                const realObj = this._deref(tg);
                return realObj?.[prop]?.(...args);
            };
        }
        ;
        return value;
    }
    set(tg, prop, value, _receiver) {
        const obj = this._deref(tg);
        if (obj)
            return Reflect.set(obj, prop, value);
        return true;
    }
    has(tg, prop) {
        const obj = this._deref(tg);
        if (!obj)
            return false;
        return prop in obj;
    }
    ownKeys(tg) {
        const obj = this._deref(tg);
        if (!obj)
            return [];
        return Reflect.ownKeys(obj);
    }
    getOwnPropertyDescriptor(tg, prop) {
        const obj = this._deref(tg);
        if (!obj)
            return undefined;
        return Object.getOwnPropertyDescriptor(obj, prop);
    }
    deleteProperty(tg, prop) {
        const obj = this._deref(tg);
        if (!obj)
            return true;
        return Reflect.deleteProperty(obj, prop);
    }
    defineProperty(tg, prop, descriptor) {
        const obj = this._deref(tg);
        if (!obj)
            return true;
        return Reflect.defineProperty(obj, prop, descriptor);
    }
    getPrototypeOf(tg) {
        const obj = this._deref(tg);
        if (!obj)
            return null;
        return Object.getPrototypeOf(obj);
    }
    setPrototypeOf(tg, proto) {
        const obj = this._deref(tg);
        if (!obj)
            return true;
        return Reflect.setPrototypeOf(obj, proto);
    }
    isExtensible(tg) {
        const obj = this._deref(tg);
        if (!obj)
            return false;
        return Reflect.isExtensible(obj);
    }
    preventExtensions(tg) {
        const obj = this._deref(tg);
        if (!obj)
            return true;
        return Reflect.preventExtensions(obj);
    }
}
/**
 * Create a WeakRef wrapper proxy that allows safe access to weakly referenced objects.
 * The proxy automatically dereferences WeakRefs when accessing properties and handles
 * function calls on weakly referenced objects.
 * @template T - The type of the target object (must be object or Function)
 * @param target - The target object or WeakRef to wrap
 * @returns A proxy that safely accesses the weakly referenced object
 */
export function WRef(target) {
    if (!(typeof target == "object" || typeof target == "function") || typeof target == "symbol")
        return target;
    const isWeakRef = (target instanceof WeakRef || typeof target?.deref == "function");
    target = (isWeakRef ? target?.deref?.() : target);
    if (target != null && existsMap.has(target)) {
        return existsMap.get(target);
    }
    //
    const handler = new WeakRefProxyHandler(); // !here may be dead WeakRef
    const pm = new Proxy(isWeakRef ? target : new WeakRef(target), handler);
    existsMap.set(target, pm);
    return pm;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiV1JlZi5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIldSZWYudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsRUFBRTtBQUNGLE1BQU0sU0FBUyxHQUFHLElBQUksT0FBTyxFQUFnQixDQUFDO0FBUzlDLEVBQUU7QUFDRixNQUFNLG1CQUFtQjtJQUNiLE1BQU0sQ0FBQyxNQUFNLElBQW1CLE9BQU8sQ0FBQyxNQUFNLFlBQVksT0FBTyxJQUFJLE9BQU8sTUFBTSxFQUFFLEtBQUssSUFBSSxVQUFVLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxNQUFNLEVBQUUsS0FBSyxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsYUFBYTtJQUVoSyxFQUFFO0lBQ0YsR0FBRyxDQUFDLEVBQVUsRUFBRSxJQUFpQixFQUFFLFNBQWM7UUFDN0MsTUFBTSxHQUFHLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxFQUFFLENBQUMsRUFBRSxLQUFLLEdBQUksR0FBVyxFQUFFLENBQUMsSUFBSSxDQUFDLENBQUM7UUFFMUQsdUNBQXVDO1FBQ3ZDLElBQUksQ0FBQyxJQUFJLElBQUksU0FBUyxJQUFJLElBQUksSUFBSSxPQUFPLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQyxLQUFLLElBQUksSUFBSSxJQUFJLENBQUMsQ0FBQyxJQUFJLElBQUksR0FBRyxDQUFDLENBQUMsRUFBRSxDQUFDO1lBQUMsT0FBTyxHQUFHLENBQUM7UUFBQyxDQUFDO1FBQ3ZHLG9DQUFvQztRQUNwQyxJQUFJLElBQUksSUFBSSxPQUFPLEVBQUUsQ0FBQztZQUFDLE9BQU8sR0FBRSxFQUFFLENBQUEsSUFBSSxDQUFDLE1BQU0sQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUFDLENBQUM7UUFBQSxDQUFDO1FBQ3JELG1DQUFtQztRQUNuQyxJQUFJLE9BQU8sS0FBSyxJQUFJLFVBQVUsRUFBRSxDQUFDO1lBQzdCLE9BQU8sQ0FBQyxHQUFHLElBQVcsRUFB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SUFBSSxPQUFPLENBQUMsTUFBTSxDQUFDLEVBQUUsT0FBbUMsQ0FBVSxDQUFDO0lBQ3BILFNBQVMsQ0FBQyxHQUFHLENBQUMsTUFBTSxFQUFFLEVBQUUsQ0FBQyxDQUFDO0lBQUMsT0FBTyxFQUFFLENBQUM7QUFDekMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIi8vXG5jb25zdCBleGlzdHNNYXAgPSBuZXcgV2Vha01hcDxhbnksIFdSPGFueT4+KCk7XG5cbi8vXG5leHBvcnQgdHlwZSBXUmVmPFQ+ID0ge1xuICAgIFtLIGluIGtleW9mIFRdOiBUW0tdIGV4dGVuZHMgKC4uLmFyZ3M6IGluZmVyIEEpID0+IGluZmVyIFJcbiAgICAgICAgPyAoLi4uYXJnczogQSkgPT4gV1JlZjxSPiB8IG51bGxcbiAgICAgICAgOiBUW0tdIHwgbnVsbDtcbn07XG5cbi8vXG5jbGFzcyBXZWFrUmVmUHJveHlIYW5kbGVyPFQgZXh0ZW5kcyBvYmplY3R8RnVuY3Rpb24+IGltcGxlbWVudHMgUHJveHlIYW5kbGVyPG9iamVjdD4ge1xuICAgIHByaXZhdGUgX2RlcmVmKHRhcmdldCk6IFQgfCB1bmRlZmluZWQgeyByZXR1cm4gKHRhcmdldCBpbnN0YW5jZW9mIFdlYWtSZWYgfHwgdHlwZW9mIHRhcmdldD8uZGVyZWYgPT0gXCJmdW5jdGlvblwiKSA/ICh0YXJnZXQ/LmRlcmVmPy4oKSkgOiB0YXJnZXQ7IH0gLy8gQHRzLWlnbm9yZVxuXG4gICAgLy9cbiAgICBnZXQodGc6IG9iamVjdCwgcHJvcDogUHJvcGVydHlLZXksIF9yZWNlaXZlcjogYW55KTogYW55IHtcbiAgICAgICAgY29uc3Qgb2JqID0gdGhpcy5fZGVyZWYodGcpLCB2YWx1ZSA9IChvYmogYXMgYW55KT8uW3Byb3BdO1xuXG4gICAgICAgIC8vIGxpYnJhcmllcyBzcGVjaWZpYyAoTFVSLkUvb2JqZWN0LnRzKVxuICAgICAgICBpZiAoKHByb3AgPT0gXCJlbGVtZW50XCIgfHwgcHJvcCA9PSBcInZhbHVlXCIpICYmIG9iaiAmJiAodmFsdWUgPT0gbnVsbCB8fCAhKHByb3AgaW4gb2JqKSkpIHsgcmV0dXJuIG9iajsgfVxuICAgICAgICAvLyB3cmFwLWF3YXkgZGVyZWYgZnJvbSBzaWRlLWVmZmVjdHNcbiAgICAgICAgaWYgKHByb3AgPT0gXCJkZXJlZlwiKSB7IHJldHVybiAoKT0+dGhpcy5fZGVyZWYodGcpOyB9O1xuICAgICAgICAvLyBpZiBmdW5jdGlvbiwgd29ya2Fyb3VuZCBjYWxsYWJsZVxuICAgICAgICBpZiAodHlwZW9mIHZhbHVlID09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgIHJldHVybiAoLi4uYXJnczogYW55W10pID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCByZWFsT2JqID0gdGhpcy5fZGVyZWYodGcpO1xuICAgICAgICAgICAgICAgIHJldHVybiAocmVhbE9iaiBhcyBhbnkpPy5bcHJvcF0/LiguLi5hcmdzKTtcbiAgICAgICAgICAgIH07XG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiB2YWx1ZTtcbiAgICB9XG5cbiAgICBzZXQodGc6IG9iamVjdCwgcHJvcDogUHJvcGVydHlLZXksIHZhbHVlOiBhbnksIF9yZWNlaXZlcjogYW55KTogYm9vbGVhbiB7XG4gICAgICAgIGNvbnN0IG9iaiA9IHRoaXMuX2RlcmVmKHRnKTsgaWYgKG9iaikgcmV0dXJuIFJlZmxlY3Quc2V0KG9iaiwgcHJvcCwgdmFsdWUpO1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG5cbiAgICBoYXModGc6IG9iamVjdCwgcHJvcDogUHJvcGVydHlLZXkpOiBib29sZWFuIHtcbiAgICAgICAgY29uc3Qgb2JqID0gdGhpcy5fZGVyZWYodGcpOyBpZiAoIW9iaikgcmV0dXJuIGZhbHNlO1xuICAgICAgICByZXR1cm4gcHJvcCBpbiBvYmo7XG4gICAgfVxuXG4gICAgb3duS2V5cyh0Zzogb2JqZWN0KTogQXJyYXlMaWtlPHN0cmluZyB8IHN5bWJvbD4ge1xuICAgICAgICBjb25zdCBvYmogPSB0aGlzLl9kZXJlZih0Zyk7IGlmICghb2JqKSByZXR1cm4gW107XG4gICAgICAgIHJldHVybiBSZWZsZWN0Lm93bktleXMob2JqKTtcbiAgICB9XG5cbiAgICBnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IodGc6IG9iamVjdCwgcHJvcDogUHJvcGVydHlLZXkpOiBQcm9wZXJ0eURlc2NyaXB0b3IgfCB1bmRlZmluZWQge1xuICAgICAgICBjb25zdCBvYmogPSB0aGlzLl9kZXJlZih0Zyk7IGlmICghb2JqKSByZXR1cm4gdW5kZWZpbmVkO1xuICAgICAgICByZXR1cm4gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihvYmosIHByb3ApO1xuICAgIH1cblxuICAgIGRlbGV0ZVByb3BlcnR5KHRnOiBvYmplY3QsIHByb3A6IFByb3BlcnR5S2V5KTogYm9vbGVhbiB7XG4gICAgICAgIGNvbnN0IG9iaiA9IHRoaXMuX2RlcmVmKHRnKTsgaWYgKCFvYmopIHJldHVybiB0cnVlO1xuICAgICAgICByZXR1cm4gUmVmbGVjdC5kZWxldGVQcm9wZXJ0eShvYmosIHByb3ApO1xuICAgIH1cblxuICAgIGRlZmluZVByb3BlcnR5KHRnOiBvYmplY3QsIHByb3A6IFByb3BlcnR5S2V5LCBkZXNjcmlwdG9yOiBQcm9wZXJ0eURlc2NyaXB0b3IpOiBib29sZWFuIHtcbiAgICAgICAgY29uc3Qgb2JqID0gdGhpcy5fZGVyZWYodGcpOyBpZiAoIW9iaikgcmV0dXJuIHRydWU7XG4gICAgICAgIHJldHVybiBSZWZsZWN0LmRlZmluZVByb3BlcnR5KG9iaiwgcHJvcCwgZGVzY3JpcHRvcik7XG4gICAgfVxuXG4gICAgZ2V0UHJvdG90eXBlT2YodGc6IG9iamVjdCk6IG9iamVjdCB8IG51bGwge1xuICAgICAgICBjb25zdCBvYmogPSB0aGlzLl9kZXJlZih0Zyk7IGlmICghb2JqKSByZXR1cm4gbnVsbDtcbiAgICAgICAgcmV0dXJuIE9iamVjdC5nZXRQcm90b3R5cGVPZihvYmopO1xuICAgIH1cblxuICAgIHNldFByb3RvdHlwZU9mKHRnOiBvYmplY3QsIHByb3RvOiBhbnkpOiBib29sZWFuIHtcbiAgICAgICAgY29uc3Qgb2JqID0gdGhpcy5fZGVyZWYodGcpOyBpZiAoIW9iaikgcmV0dXJuIHRydWU7XG4gICAgICAgIHJldHVybiBSZWZsZWN0LnNldFByb3RvdHlwZU9mKG9iaiwgcHJvdG8pO1xuICAgIH1cblxuICAgIGlzRXh0ZW5zaWJsZSh0Zzogb2JqZWN0KTogYm9vbGVhbiB7XG4gICAgICAgIGNvbnN0IG9iaiA9IHRoaXMuX2RlcmVmKHRnKTsgaWYgKCFvYmopIHJldHVybiBmYWxzZTtcbiAgICAgICAgcmV0dXJuIFJlZmxlY3QuaXNFeHRlbnNpYmxlKG9iaik7XG4gICAgfVxuXG4gICAgcHJldmVudEV4dGVuc2lvbnModGc6IG9iamVjdCk6IGJvb2xlYW4ge1xuICAgICAgICBjb25zdCBvYmogPSB0aGlzLl9kZXJlZih0Zyk7IGlmICghb2JqKSByZXR1cm4gdHJ1ZTtcbiAgICAgICAgcmV0dXJuIFJlZmxlY3QucHJldmVudEV4dGVuc2lvbnMob2JqKTtcbiAgICB9XG59XG5cbi8vXG5leHBvcnQgdHlwZSBXUjxUPiA9IHtcbiAgICBbSyBpbiBrZXlvZiBUXTogVFtLXSBleHRlbmRzICguLi5hcmdzOiBpbmZlciBBKSA9PiBpbmZlciBSXG4gICAgICAgID8gKC4uLmFyZ3M6IEEpID0+IFdSPFI+IHwgbnVsbFxuICAgICAgICA6IFRbS10gfCBudWxsO1xufTtcblxuLyoqXG4gKiBDcmVhdGUgYSBXZWFrUmVmIHdyYXBwZXIgcHJveHkgdGhhdCBhbGxvd3Mgc2FmZSBhY2Nlc3MgdG8gd2Vha2x5IHJlZmVyZW5jZWQgb2JqZWN0cy5cbiAqIFRoZSBwcm94eSBhdXRvbWF0aWNhbGx5IGRlcmVmZXJlbmNlcyBXZWFrUmVmcyB3aGVuIGFjY2Vzc2luZyBwcm9wZXJ0aWVzIGFuZCBoYW5kbGVzXG4gKiBmdW5jdGlvbiBjYWxscyBvbiB3ZWFrbHkgcmVmZXJlbmNlZCBvYmplY3RzLlxuICogQHRlbXBsYXRlIFQgLSBUaGUgdHlwZSBvZiB0aGUgdGFyZ2V0IG9iamVjdCAobXVzdCBiZSBvYmplY3Qgb3IgRnVuY3Rpb24pXG4gKiBAcGFyYW0gdGFyZ2V0IC0gVGhlIHRhcmdldCBvYmplY3Qgb3IgV2Vha1JlZiB0byB3cmFwXG4gKiBAcmV0dXJucyBBIHByb3h5IHRoYXQgc2FmZWx5IGFjY2Vzc2VzIHRoZSB3ZWFrbHkgcmVmZXJlbmNlZCBvYmplY3RcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIFdSZWY8VCBleHRlbmRzIG9iamVjdHxGdW5jdGlvbj4odGFyZ2V0OiBUfFdlYWtSZWY8VD4pOiBXUjxUPiB7XG4gICAgaWYgKCEodHlwZW9mIHRhcmdldCA9PSBcIm9iamVjdFwiIHx8IHR5cGVvZiB0YXJnZXQgPT0gXCJmdW5jdGlvblwiKSB8fCB0eXBlb2YgdGFyZ2V0ID09IFwic3ltYm9sXCIpIHJldHVybiB0YXJnZXQgYXMgV1I8VD47XG4gICAgY29uc3QgaXNXZWFrUmVmID0gKHRhcmdldCBpbnN0YW5jZW9mIFdlYWtSZWYgfHwgdHlwZW9mICh0YXJnZXQgYXMgYW55KT8uZGVyZWYgPT0gXCJmdW5jdGlvblwiKTtcbiAgICB0YXJnZXQgPSAoaXNXZWFrUmVmID8gKHRhcmdldCBhcyBhbnkpPy5kZXJlZj8uKCkgOiB0YXJnZXQpIGFzIHVua25vd24gYXMgVDtcbiAgICBpZiAodGFyZ2V0ICE9IG51bGwgJiYgZXhpc3RzTWFwLmhhcyh0YXJnZXQpKSB7IHJldHVybiBleGlzdHNNYXAuZ2V0KHRhcmdldCkgYXMgV1I8VD47IH1cblxuICAgIC8vXG4gICAgY29uc3QgaGFuZGxlciA9IG5ldyBXZWFrUmVmUHJveHlIYW5kbGVyPFQ+KCk7IC8vICFoZXJlIG1heSBiZSBkZWFkIFdlYWtSZWZcbiAgICBjb25zdCBwbTogV1I8VD4gPSBuZXcgUHJveHkoaXNXZWFrUmVmID8gdGFyZ2V0IDogbmV3IFdlYWtSZWYodGFyZ2V0KSwgaGFuZGxlciBhcyBQcm94eUhhbmRsZXI8V2Vha1JlZjxUPj4pIGFzIFdSPFQ+O1xuICAgIGV4aXN0c01hcC5zZXQodGFyZ2V0LCBwbSk7IHJldHVybiBwbTtcbn1cbiJdfQ==