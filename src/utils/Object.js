import { isCanJustReturn } from "./Primitive";
//
export const isIterable = (obj) => (typeof obj?.[Symbol.iterator] == "function");
export const isKeyType = (prop) => (["symbol", "string", "number"].indexOf(typeof prop) >= 0);
export const isValidObj = (obj) => { return obj != null && (typeof obj == "function" || typeof obj == "object") && !(obj instanceof WeakRef); };
export const mergeByKey = (items, key = "id") => {
    const entries = Array.from(items?.values?.()).map((I) => [I?.[key], I]);
    const map = new Map(entries);
    return Array.from(map?.values?.() || []);
};
//
export const removeExtra = (target, value, name = null) => {
    const exists = name != null && (typeof target == "object" || typeof target == "function") ? (target?.[name] ?? target) : target;
    let entries = [];
    if (value instanceof Set || value instanceof Map || Array.isArray(value) || isIterable(value)) {
        entries = ((exists instanceof Set || exists instanceof WeakSet) ? value?.values?.() : value?.entries?.()) || ((Array.isArray(value) || isIterable(value)) ? value : []);
    }
    else if (typeof value == "object" || typeof value == "function") {
        entries = (exists instanceof Set || exists instanceof WeakSet) ? Object.values(value) : Object.entries(value);
    }
    //
    let exEntries = [];
    if (Array.isArray(exists)) {
        exEntries = exists.entries();
    }
    else // @ts-ignore
     if (exists instanceof Map || exists instanceof WeakMap) {
        exEntries = exists?.entries?.();
    }
    else // @ts-ignore
     if (exists instanceof Set || exists instanceof WeakSet) {
        exEntries = exists?.values?.();
    }
    else if (typeof exists == "object" || typeof exists == "function") {
        exEntries = Object.entries(exists);
    }
    //
    const keys = new Set(Array.from(entries).map((e) => e?.[0]));
    const exe = new Set(Array.from(exEntries).map((e) => e?.[0]));
    // @ts-ignore // REQUIRES NEW ECMASCRIPT!!!
    const exclude = keys?.difference?.(exe);
    //
    if (Array.isArray(exists)) {
        const nw = exists.filter((_, I) => !exclude.has(I));
        exists.splice(0, exists.length);
        exists.push(...nw);
    }
    else if ((exists instanceof Map || exists instanceof Set) || (exists instanceof WeakMap || exists instanceof WeakSet)) {
        for (const k of exclude) {
            exists.delete(k);
        }
        ;
    }
    else if (typeof exists == "function" || typeof exists == "object") {
        for (const k of exclude) {
            delete exists[k];
        }
        ;
    }
    ;
    return exists;
};
//
export const objectAssign = (target, value, name = null, removeNotExists = true, mergeKey = "id") => {
    const exists = name != null && (typeof target == "object" || typeof target == "function") ? (target?.[name] ?? target) : target;
    let entries = null;
    if (removeNotExists) {
        removeExtra(exists, value);
    }
    //
    if (value instanceof Set || value instanceof Map || Array.isArray(value) || isIterable(value)) {
        entries = ((exists instanceof Set || exists instanceof WeakSet) ? value?.values?.() : value?.entries?.()) || ((Array.isArray(value) || isIterable(value)) ? value : []);
    }
    else if (typeof value == "object" || typeof value == "function") {
        entries = (exists instanceof Set || exists instanceof WeakSet) ? Object.values(value) : Object.entries(value);
    }
    //
    if (exists && entries && (typeof entries == "object" || typeof entries == "function")) {
        if (exists instanceof Map || exists instanceof WeakMap) // @ts-ignore
         {
            for (const E of entries) {
                exists.set(...E);
            }
            ;
            return exists;
        }
        //
        if (exists instanceof Set || exists instanceof WeakSet) {
            for (const E of entries) { // @ts-ignore
                const mergeObj = E?.[mergeKey] ? Array.from(exists?.values?.() || []).find((I) => !isNotEqual?.(I?.[mergeKey], E?.[mergeKey])) : null;
                if (mergeObj != null) {
                    objectAssign(mergeObj, E, null, removeNotExists, mergeKey);
                }
                else {
                    exists.add(E);
                }
            }
            return exists;
        }
        //
        if (typeof exists == "object" || typeof exists == "function") {
            if (Array.isArray(exists) || isIterable(exists)) {
                let I = 0;
                for (const E of entries) {
                    if (I < exists.length) {
                        exists[I++] = E?.[1];
                    }
                    else {
                        exists?.push?.(E?.[1]);
                    }
                    ;
                }
                return exists;
            }
            return Object.assign(exists, Object.fromEntries([...(entries || [])].filter((K) => (typeof K != "symbol"))));
        }
    }
    //
    if (name != null) {
        Reflect.set(target, name, value);
        return target;
    }
    else if (typeof value == "object" || typeof value == "function") {
        return Object.assign(target, value);
    }
    ;
    return value;
};
//
export const bindFx = (target, fx) => {
    // !experimental `getOrInsert` feature!
    // @ts-ignore
    const be = boundCtx.getOrInsert(target, new WeakMap());
    return be.getOrInsert(fx, fx?.bind?.(target));
};
//
export const bindCtx = (target, fx) => ((typeof fx == "function" ? bindFx(target, fx) : fx) ?? fx);
//
export const callByProp = (unwrap, prop, cb, ctx) => {
    if (prop == Symbol.iterator) {
        return callByAllProp(unwrap, cb, ctx);
    }
    ;
    //
    if (prop == null ||
        //(prop == $extractKey$ || prop == $originalKey$ || prop == $registryKey$) ||
        (typeof prop == "symbol" || typeof prop == "object" || typeof prop == "function"))
        return;
    //
    const callIfNotNull = (v, ...args) => {
        if (v != null) {
            return cb?.(v, ...args);
        }
    };
    //
    if (unwrap instanceof Map || unwrap instanceof WeakMap) {
        if (unwrap.has(prop)) {
            return callIfNotNull?.(unwrap.get(prop), prop, null, "@set");
        }
    }
    else if (unwrap instanceof Set || unwrap instanceof WeakSet) {
        if (unwrap.has(prop)) {
            return callIfNotNull?.(prop, prop, null, "@add");
        }
    }
    else if (Array.isArray(unwrap) && (typeof prop == "string" && [...prop?.matchAll?.(/^\d+$/g)]?.length == 1) && Number.isInteger(typeof prop == "string" ? parseInt(prop) : prop)) {
        const index = typeof prop == "string" ? parseInt(prop) : prop;
        return callIfNotNull?.(unwrap?.[index], index, null, "@add");
    }
    else if (typeof unwrap == "function" || typeof unwrap == "object") {
        return callIfNotNull?.(unwrap?.[prop], prop, null, "@set");
    }
};
//
export const objectAssignNotEqual = (dst, src = {}) => { Object.entries(src)?.forEach?.(([k, v]) => { if (isNotEqual(v, dst[k])) {
    dst[k] = v;
} ; }); return dst; };
export const callByAllProp = (unwrap, cb, ctx) => {
    if (unwrap == null)
        return;
    //
    let keys = [];
    if (unwrap instanceof Set || unwrap instanceof Map || typeof unwrap?.keys == "function") {
        return [...(unwrap?.keys?.() || keys)]?.forEach?.((prop) => callByProp(unwrap, prop, cb, ctx));
    }
    if (Array.isArray(unwrap) || isIterable(unwrap)) {
        return [...unwrap]?.forEach?.((v, I) => callByProp(unwrap, I, cb, ctx));
    }
    if (typeof unwrap == "object" || typeof unwrap == "function") {
        return [...(Object.keys(unwrap) || keys)]?.forEach?.((prop) => callByProp(unwrap, prop, cb, ctx));
    }
};
//
export const isObjectNotEqual = (a, b) => {
    if (a == null && b == null)
        return false;
    if (a == null || b == null)
        return true; // @ts-ignore
    if (a instanceof Map || a instanceof WeakMap) {
        return a.size != b.size || Array.from(a.entries()).some(([k, v]) => !b.has(k) || !isNotEqual(v, b.get(k)));
    } // @ts-ignore
    if (a instanceof Set || a instanceof WeakSet) {
        return a.size != b.size || Array.from(a.values()).some((v) => !b.has(v));
    } // @ts-ignore
    if (Array.isArray(a) || Array.isArray(b)) {
        return a.length != b.length || a.some((v, i) => !isNotEqual(v, b[i]));
    }
    if (typeof a == "object" || typeof b == "object") {
        return JSON.stringify(a) != JSON.stringify(b);
    }
    return a != b;
};
//
export const isNotEqual = (a, b) => {
    if (a == null && b == null)
        return false;
    if (a == null || b == null)
        return true;
    if (typeof a == "boolean" && typeof b == "boolean") {
        return a != b;
    }
    if (typeof a == "number" && typeof b == "number") {
        return !(a == b || (Math.abs(a - b) < 1e-9));
    }
    if (typeof a == "string" && typeof b == "string") {
        return ((a != "" && b != "") && a != b) || a !== b;
    }
    if ((typeof a) != (typeof b)) {
        return a !== b;
    }
    return (a && b && a != b) || a !== b;
};
//
export const boundCtx = new WeakMap();
//
export const isArrayInvalidKey = (key, src) => {
    const invalidForArray = key == null || key < 0 || typeof key != "number" || key == Symbol.iterator || (src != null ? key >= (src?.length || 0) : false);
    return (src != null ? Array.isArray(src) && invalidForArray : false);
};
//
export const inProxy = new WeakMap();
export const contextify = (pc, name) => { return (typeof pc?.[name] == "function" ? pc?.[name]?.bind?.(pc) : pc?.[name]); };
//
export const deepOperateAndClone = (obj, operation, $prev) => {
    if (Array.isArray(obj)) {
        if (obj.every(isCanJustReturn))
            return obj.map(operation);
        return obj.map((value, index) => deepOperateAndClone(value, operation, [obj, index]));
    }
    if (obj instanceof Map) {
        const entries = Array.from(obj.entries());
        const values = entries.map(([key, value]) => value);
        if (values.every(isCanJustReturn))
            return new Map(entries.map(([key, value]) => [key, operation(value, key, obj)]));
        return new Map(entries.map(([key, value]) => [key, deepOperateAndClone(value, operation, [obj, key])]));
    }
    if (obj instanceof Set) {
        const entries = Array.from(obj.entries());
        const values = entries.map(([key, value]) => value);
        if (entries.every(isCanJustReturn))
            return new Set(values.map(operation));
        return new Set(values.map(value => deepOperateAndClone(value, operation, [obj, value])));
    }
    if (typeof obj == "object" && (obj?.constructor == Object && Object.prototype.toString.call(obj) == "[object Object]")) {
        const entries = Array.from(Object.entries(obj));
        const values = entries.map(([key, value]) => value);
        if (values.every(isCanJustReturn))
            return Object.fromEntries(entries.map(([key, value]) => [key, operation(value, key, obj)]));
        return Object.fromEntries(entries.map(([key, value]) => [key, deepOperateAndClone(value, operation, [obj, key])]));
    }
    return operation(obj, $prev?.[1] ?? "", $prev?.[0] ?? null);
};
//
export const bindEvent = (on, key, value) => {
    if (on?.[key] != null) {
        const exists = on[key];
        if (Array.isArray(value)) {
            exists.add(...value);
        }
        else if (typeof value == "function") {
            exists.add(value);
        }
        return on;
    }
    on[key] ??= Array.isArray(value) ? new Set(value) : (typeof value == "function" ? new Set([value]) : value);
    return on;
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiT2JqZWN0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiT2JqZWN0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxhQUFhLENBQUM7QUFNOUMsRUFBRTtBQUNGLE1BQU0sQ0FBQyxNQUFNLFVBQVUsR0FBRyxDQUFDLEdBQUcsRUFBRSxFQUFFLENBQUMsQ0FBQyxPQUFPLEdBQUcsRUFBRSxDQUFDLE1BQU0sQ0FBQyxRQUFRLENBQUMsSUFBSSxVQUFVLENBQUMsQ0FBQztBQUNqRixNQUFNLENBQUMsTUFBTSxTQUFTLEdBQUksQ0FBQyxJQUFtQixFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUMsUUFBUSxFQUFFLFFBQVEsRUFBRSxRQUFRLENBQUMsQ0FBQyxPQUFPLENBQUMsT0FBTyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQztBQUM5RyxNQUFNLENBQUMsTUFBTSxVQUFVLEdBQUcsQ0FBQyxHQUFTLEVBQUMsRUFBRSxHQUFHLE9BQU8sR0FBRyxJQUFJLElBQUksSUFBSSxDQUFDLE9BQU8sR0FBRyxJQUFJLFVBQVUsSUFBSSxPQUFPLEdBQUcsSUFBSSxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUMsR0FBRyxZQUFZLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO0FBQ3JKLE1BQU0sQ0FBQyxNQUFNLFVBQVUsR0FBRyxDQUFDLEtBQXFCLEVBQUUsR0FBRyxHQUFHLElBQUksRUFBQyxFQUFFO0lBQzNELE1BQU0sT0FBTyxHQUFHLEtBQUssQ0FBQyxJQUFJLENBQUMsS0FBSyxFQUFFLE1BQU0sRUFBRSxFQUFFLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLEVBQUMsRUFBRSxDQUFBLENBQUMsQ0FBQyxFQUFFLENBQUMsR0FBRyxDQUFDLEVBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUNyRSxNQUFNLEdBQUcsR0FBRyxJQUFJLEdBQUcsQ0FBQyxPQUFjLENBQUMsQ0FBQztJQUNwQyxPQUFPLEtBQUssQ0FBQyxJQUFJLENBQUMsR0FBRyxFQUFFLE1BQU0sRUFBRSxFQUFFLElBQUksRUFBRSxDQUFDLENBQUM7QUFDN0MsQ0FBQyxDQUFBO0FBRUQsRUFBRTtBQUNGLE1BQU0sQ0FBQyxNQUFNLFdBQVcsR0FBRyxDQUFDLE1BQU0sRUFBRSxLQUFLLEVBQUUsT0FBdUIsSUFBSSxFQUFDLEVBQUU7SUFDckUsTUFBTSxNQUFNLEdBQUcsSUFBSSxJQUFJLElBQUksSUFBSSxDQUFDLE9BQU8sTUFBTSxJQUFJLFFBQVEsSUFBSSxPQUFPLE1BQU0sSUFBSSxVQUFVLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxJQUFJLENBQUMsSUFBSSxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDO0lBQUMsSUFBSSxPQUFPLEdBQVEsRUFBRSxDQUFDO0lBQ3ZKLElBQUksS0FBSyxZQUFZLEdBQUcsSUFBSSxLQUFLLFlBQVksR0FBRyxJQUFJLEtBQUssQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLElBQUksVUFBVSxDQUFDLEtBQUssQ0FBQyxFQUFFLENBQUM7UUFBQyxPQUFPLEdBQUcsQ0FBQyxDQUFDLE1BQU0sWUFBWSxHQUFHLElBQUksTUFBTSxZQUFZLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQyxLQUFLLEVBQUUsTUFBTSxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUMsS0FBSyxFQUFFLE9BQU8sRUFBRSxFQUFFLENBQUMsSUFBSSxDQUFDLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsSUFBSSxVQUFVLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQztJQUFDLENBQUM7U0FDM1EsSUFBSSxPQUFPLEtBQUssSUFBSSxRQUFRLElBQUksT0FBTyxLQUFLLElBQUksVUFBVSxFQUFFLENBQUM7UUFBQyxPQUFPLEdBQUcsQ0FBQyxNQUFNLFlBQVksR0FBRyxJQUFJLE1BQU0sWUFBWSxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsQ0FBQztJQUFDLENBQUM7SUFFOUssRUFBRTtJQUNGLElBQUksU0FBUyxHQUFRLEVBQUUsQ0FBQztJQUFDLElBQUksS0FBSyxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsRUFBRSxDQUFDO1FBQUMsU0FBUyxHQUFHLE1BQU0sQ0FBQyxPQUFPLEVBQUUsQ0FBQztJQUFDLENBQUM7U0FBTSxhQUFhO0tBQ3hHLElBQUksTUFBTSxZQUFZLEdBQUcsSUFBSSxNQUFNLFlBQVksT0FBTyxFQUFFLENBQUM7UUFBQyxTQUFTLEdBQUcsTUFBTSxFQUFFLE9BQU8sRUFBRSxFQUFFLENBQUM7SUFBQyxDQUFDO1NBQU0sYUFBYTtLQUMvRyxJQUFJLE1BQU0sWUFBWSxHQUFHLElBQUksTUFBTSxZQUFZLE9BQU8sRUFBRSxDQUFDO1FBQUMsU0FBUyxHQUFHLE1BQU0sRUFBRSxNQUFNLEVBQUUsRUFBRSxDQUFDO0lBQUMsQ0FBQztTQUMzRixJQUFJLE9BQU8sTUFBTSxJQUFJLFFBQVEsSUFBSSxPQUFPLE1BQU0sSUFBSSxVQUFVLEVBQUUsQ0FBQztRQUFDLFNBQVMsR0FBRyxNQUFNLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxDQUFDO0lBQUMsQ0FBQztJQUVyRyxFQUFFO0lBQ0YsTUFBTSxJQUFJLEdBQUcsSUFBSSxHQUFHLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLEVBQUMsRUFBRSxDQUFBLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUMzRCxNQUFNLEdBQUcsR0FBSSxJQUFJLEdBQUcsQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsRUFBQyxFQUFFLENBQUEsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBRTdELDJDQUEyQztJQUMzQyxNQUFNLE9BQU8sR0FBRyxJQUFJLEVBQUUsVUFBVSxFQUFFLENBQUMsR0FBRyxDQUFDLENBQUM7SUFFeEMsRUFBRTtJQUNGLElBQUksS0FBSyxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsRUFBRSxDQUFDO1FBQUMsTUFBTSxFQUFFLEdBQUcsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsRUFBQyxDQUFDLEVBQUMsRUFBRSxDQUFBLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLEVBQUUsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxHQUFHLEVBQUUsQ0FBQyxDQUFDO0lBQUMsQ0FBQztTQUNySSxJQUFJLENBQUMsTUFBTSxZQUFZLEdBQUcsSUFBSSxNQUFNLFlBQVksR0FBRyxDQUFDLElBQUksQ0FBQyxNQUFNLFlBQVksT0FBTyxJQUFJLE1BQU0sWUFBWSxPQUFPLENBQUMsRUFBRSxDQUFDO1FBQUMsS0FBSyxNQUFNLENBQUMsSUFBSSxPQUFPLEVBQUUsQ0FBQztZQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFBQyxDQUFDO1FBQUEsQ0FBQztJQUFDLENBQUM7U0FDckssSUFBSSxPQUFPLE1BQU0sSUFBSSxVQUFVLElBQUksT0FBTyxNQUFNLElBQUksUUFBUSxFQUFFLENBQUM7UUFBQyxLQUFLLE1BQU0sQ0FBQyxJQUFJLE9BQU8sRUFBRSxDQUFDO1lBQUMsT0FBTyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFBQyxDQUFDO1FBQUEsQ0FBQztJQUFDLENBQUM7SUFBQSxDQUFDO0lBQUMsT0FBTyxNQUFNLENBQUM7QUFDckksQ0FBQyxDQUFBO0FBRUQsRUFBRTtBQUNGLE1BQU0sQ0FBQyxNQUFNLFlBQVksR0FBRyxDQUFDLE1BQU0sRUFBRSxLQUFLLEVBQUUsT0FBdUIsSUFBSSxFQUFFLGVBQWUsR0FBRyxJQUFJLEVBQUUsUUFBUSxHQUFHLElBQUksRUFBRSxFQUFFO0lBQ2hILE1BQU0sTUFBTSxHQUFHLElBQUksSUFBSSxJQUFJLElBQUksQ0FBQyxPQUFPLE1BQU0sSUFBSSxRQUFRLElBQUksT0FBTyxNQUFNLElBQUksVUFBVSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsTUFBTSxFQUFFLENBQUMsSUFBSSxDQUFDLElBQUksTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQztJQUNoSSxJQUFJLE9BQU8sR0FBUSxJQUFJLENBQUM7SUFBQyxJQUFJLGVBQWUsRUFBRSxDQUFDO1FBQUMsV0FBVyxDQUFDLE1BQU0sRUFBRSxLQUFLLENBQUMsQ0FBQztJQUFDLENBQUM7SUFFN0UsRUFBRTtJQUNGLElBQUksS0FBSyxZQUFZLEdBQUcsSUFBSSxLQUFLLFlBQVksR0FBRyxJQUFJLEtBQUssQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLElBQUksVUFBVSxDQUFDLEtBQUssQ0FBQyxFQUFFLENBQUM7UUFBQyxPQUFPLEdBQUcsQ0FBQyxDQUFDLE1BQU0sWUFBWSxHQUFHLElBQUksTUFBTSxZQUFZLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQyxLQUFLLEVBQUUsTUFBTSxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUMsS0FBSyxFQUFFLE9BQU8sRUFBRSxFQUFFLENBQUMsSUFBSSxDQUFDLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsSUFBSSxVQUFVLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQztJQUFDLENBQUM7U0FDM1EsSUFBSSxPQUFPLEtBQUssSUFBSSxRQUFRLElBQUksT0FBTyxLQUFLLElBQUksVUFBVSxFQUFFLENBQUM7UUFBQyxPQUFPLEdBQUcsQ0FBQyxNQUFNLFlBQVksR0FBRyxJQUFJLE1BQU0sWUFBWSxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsQ0FBQztJQUFDLENBQUM7SUFFOUssRUFBRTtJQUNGLElBQUksTUFBTSxJQUFJLE9BQU8sSUFBSSxDQUFDLE9BQU8sT0FBTyxJQUFJLFFBQVEsSUFBSSxPQUFPLE9BQU8sSUFBSSxVQUFVLENBQUMsRUFBRSxDQUFDO1FBQ3BGLElBQUksTUFBTSxZQUFZLEdBQUcsSUFBSSxNQUFNLFlBQVksT0FBTyxFQUFFLGFBQWE7U0FDakUsQ0FBQztZQUFDLEtBQUssTUFBTSxDQUFDLElBQUksT0FBTyxFQUFFLENBQUM7Z0JBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO1lBQUMsQ0FBQztZQUFBLENBQUM7WUFBQyxPQUFPLE1BQU0sQ0FBQztRQUFDLENBQUM7UUFFdEUsRUFBRTtRQUNGLElBQUksTUFBTSxZQUFZLEdBQUcsSUFBSSxNQUFNLFlBQVksT0FBTyxFQUNsRCxDQUFDO1lBQUMsS0FBSyxNQUFNLENBQUMsSUFBSSxPQUFPLEVBQUUsQ0FBQyxDQUFDLGFBQWE7Z0JBQ3RDLE1BQU0sUUFBUSxHQUFHLENBQUMsRUFBRSxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLE1BQU0sRUFBRSxNQUFNLEVBQUUsRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsRUFBQyxFQUFFLENBQUEsQ0FBQyxVQUFVLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxRQUFRLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQztnQkFDcEksSUFBSSxRQUFRLElBQUksSUFBSSxFQUFFLENBQUM7b0JBQUMsWUFBWSxDQUFDLFFBQVEsRUFBRSxDQUFDLEVBQUUsSUFBSSxFQUFFLGVBQWUsRUFBRSxRQUFRLENBQUMsQ0FBQztnQkFBQyxDQUFDO3FCQUFNLENBQUM7b0JBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQztnQkFBQyxDQUFDO1lBQ2pILENBQUM7WUFBQyxPQUFPLE1BQU0sQ0FBQztRQUFDLENBQUM7UUFFdEIsRUFBRTtRQUNGLElBQUksT0FBTyxNQUFNLElBQUksUUFBUSxJQUFJLE9BQU8sTUFBTSxJQUFJLFVBQVUsRUFBRSxDQUFDO1lBQzNELElBQUksS0FBSyxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsSUFBSSxVQUFVLENBQUMsTUFBTSxDQUFDLEVBQUUsQ0FBQztnQkFDOUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO2dCQUFDLEtBQUssTUFBTSxDQUFDLElBQUksT0FBTyxFQUM5QixDQUFDO29CQUFDLElBQUksQ0FBQyxHQUFHLE1BQU0sQ0FBQyxNQUFNLEVBQUUsQ0FBQzt3QkFBQyxNQUFNLENBQUMsQ0FBQyxFQUFFLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQztvQkFBQyxDQUFDO3lCQUFNLENBQUM7d0JBQUMsTUFBTSxFQUFFLElBQUksRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7b0JBQUMsQ0FBQztvQkFBQSxDQUFDO2dCQUFDLENBQUM7Z0JBQzFGLE9BQU8sTUFBTSxDQUFDO1lBQ2xCLENBQUM7WUFDRCxPQUFPLE1BQU0sQ0FBQyxNQUFNLENBQUMsTUFBTSxFQUFFLE1BQU0sQ0FBQyxXQUFXLENBQUMsQ0FBQyxHQUFHLENBQUMsT0FBTyxJQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxFQUFDLEVBQUUsQ0FBQSxDQUFDLE9BQU8sQ0FBQyxJQUFJLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQzdHLENBQUM7SUFDTCxDQUFDO0lBRUQsRUFBRTtJQUNGLElBQUksSUFBSSxJQUFJLElBQUksRUFBRSxDQUFDO1FBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxNQUFNLEVBQUUsSUFBSSxFQUFFLEtBQUssQ0FBQyxDQUFDO1FBQUMsT0FBTyxNQUFNLENBQUM7SUFBQyxDQUFDO1NBQ3RFLElBQUksT0FBTyxLQUFLLElBQUksUUFBUSxJQUFJLE9BQU8sS0FBSyxJQUFJLFVBQVUsRUFDdEQsQ0FBQztRQUFDLE9BQU8sTUFBTSxDQUFDLE1BQU0sQ0FBQyxNQUFNLEVBQUUsS0FBSyxDQUFDLENBQUM7SUFBQyxDQUFDO0lBQUEsQ0FBQztJQUFDLE9BQU8sS0FBSyxDQUFDO0FBQy9ELENBQUMsQ0FBQTtBQUdELEVBQUU7QUFDRixNQUFNLENBQUMsTUFBTSxNQUFNLEdBQUcsQ0FBQyxNQUFNLEVBQUUsRUFBRSxFQUFDLEVBQUU7SUFDaEMsdUNBQXVDO0lBQ3ZDLGFBQWE7SUFDYixNQUFNLEVBQUUsR0FBRyxRQUFRLENBQUMsV0FBVyxDQUFDLE1BQU0sRUFBRSxJQUFJLE9BQU8sRUFBRSxDQUFDLENBQUM7SUFDdkQsT0FBTyxFQUFFLENBQUMsV0FBVyxDQUFDLEVBQUUsRUFBRSxFQUFFLEVBQUUsSUFBSSxFQUFFLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQztBQUNsRCxDQUFDLENBQUE7QUFFRCxFQUFFO0FBQ0YsTUFBTSxDQUFDLE1BQU0sT0FBTyxHQUFNLENBQUMsTUFBTSxFQUFFLEVBQUUsRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFDLE9BQU8sRUFBRSxJQUFJLFVBQVUsQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLE1BQU0sRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLElBQUksRUFBRSxDQUFDLENBQUM7QUFFdEcsRUFBRTtBQUNGLE1BQU0sQ0FBQyxNQUFNLFVBQVUsR0FBRyxDQUFDLE1BQU0sRUFBRSxJQUFhLEVBQUUsRUFBRSxFQUFFLEdBQUcsRUFBRSxFQUFFO0lBQ3pELElBQUksSUFBSSxJQUFJLE1BQU0sQ0FBQyxRQUFRLEVBQUUsQ0FBQztRQUFDLE9BQU8sYUFBYSxDQUFDLE1BQU0sRUFBRSxFQUFFLEVBQUUsR0FBRyxDQUFDLENBQUM7SUFBQyxDQUFDO0lBQUEsQ0FBQztJQUV4RSxFQUFFO0lBQ0YsSUFDSSxJQUFJLElBQUksSUFBSTtRQUNaLDZFQUE2RTtRQUM3RSxDQUFDLE9BQU8sSUFBSSxJQUFJLFFBQVEsSUFBSSxPQUFPLElBQUksSUFBSSxRQUFRLElBQUksT0FBTyxJQUFJLElBQUksVUFBVSxDQUFDO1FBQ25GLE9BQU87SUFFVCxFQUFFO0lBQ0YsTUFBTSxhQUFhLEdBQUcsQ0FBQyxDQUFDLEVBQUUsR0FBRyxJQUFJLEVBQUMsRUFBRTtRQUNoQyxJQUFJLENBQUMsSUFBSSxJQUFJLEVBQUUsQ0FBQztZQUFDLE9BQU8sRUFBRSxFQUFFLENBQUMsQ0FBQyxFQUFFLEdBQUcsSUFBSSxDQUFDLENBQUM7UUFBQyxDQUFDO0lBQy9DLENBQUMsQ0FBQTtJQUVELEVBQUU7SUFDRixJQUFJLE1BQU0sWUFBWSxHQUFHLElBQUksTUFBTSxZQUFZLE9BQU8sRUFBRSxDQUFDO1FBQ3JELElBQUksTUFBTSxDQUFDLEdBQUcsQ0FBQyxJQUFXLENBQUMsRUFBRSxDQUFDO1lBQUMsT0FBTyxhQUFhLEVBQUUsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLElBQVcsQ0FBQyxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsTUFBTSxDQUFDLENBQUM7UUFBQyxDQUFDO0lBQ3pHLENBQUM7U0FDRyxJQUFJLE1BQU0sWUFBWSxHQUFHLElBQUksTUFBTSxZQUFZLE9BQU8sRUFBRSxDQUFDO1FBQ3JELElBQUksTUFBTSxDQUFDLEdBQUcsQ0FBQyxJQUFXLENBQUMsRUFBRSxDQUFDO1lBQUMsT0FBTyxhQUFhLEVBQUUsQ0FBQyxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxNQUFNLENBQUMsQ0FBQztRQUFDLENBQUM7SUFDdEYsQ0FBQztTQUNHLElBQUksS0FBSyxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLE9BQU8sSUFBSSxJQUFJLFFBQVEsSUFBSSxDQUFDLEdBQUcsSUFBSSxFQUFFLFFBQVEsRUFBRSxDQUFDLFFBQVEsQ0FBQyxDQUFDLEVBQUUsTUFBTSxJQUFJLENBQUMsQ0FBQyxJQUFJLE1BQU0sQ0FBQyxTQUFTLENBQUMsT0FBTyxJQUFJLElBQUksUUFBUSxDQUFDLENBQUMsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUM7UUFDMUssTUFBTSxLQUFLLEdBQUcsT0FBTyxJQUFJLElBQUksUUFBUSxDQUFDLENBQUMsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQztRQUM5RCxPQUFPLGFBQWEsRUFBRSxDQUFDLE1BQU0sRUFBRSxDQUFDLEtBQUssQ0FBQyxFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUUsTUFBTSxDQUFDLENBQUM7SUFDakUsQ0FBQztTQUNHLElBQUksT0FBTyxNQUFNLElBQUksVUFBVSxJQUFJLE9BQU8sTUFBTSxJQUFJLFFBQVEsRUFBRSxDQUFDO1FBQUMsT0FBTyxhQUFhLEVBQUUsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxJQUFJLENBQUMsRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLE1BQU0sQ0FBQyxDQUFDO0lBQUMsQ0FBQztBQUM3SSxDQUFDLENBQUE7QUFFRCxFQUFFO0FBQ0YsTUFBTSxDQUFDLE1BQU0sb0JBQW9CLEdBQUcsQ0FBQyxHQUFHLEVBQUUsR0FBRyxHQUFHLEVBQUUsRUFBQyxFQUFFLEdBQUUsTUFBTSxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsRUFBRSxPQUFPLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFDLENBQUMsQ0FBQyxFQUFDLEVBQUUsR0FBRSxJQUFJLFVBQVUsQ0FBQyxDQUFDLEVBQUUsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQztJQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUM7QUFBQyxDQUFDLENBQUEsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsT0FBTyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUE7QUFDOUosTUFBTSxDQUFDLE1BQU0sYUFBYSxHQUFHLENBQUMsTUFBTSxFQUFFLEVBQUUsRUFBRSxHQUFHLEVBQUMsRUFBRTtJQUM1QyxJQUFJLE1BQU0sSUFBSSxJQUFJO1FBQUUsT0FBTztJQUUzQixFQUFFO0lBQ0YsSUFBSSxJQUFJLEdBQVEsRUFBRSxDQUFDO0lBRW5CLElBQUksTUFBTSxZQUFZLEdBQUcsSUFBSSxNQUFNLFlBQVksR0FBRyxJQUFJLE9BQU8sTUFBTSxFQUFFLElBQUksSUFBSSxVQUFVLEVBQUUsQ0FBQztRQUN0RixPQUFPLENBQUMsR0FBRyxDQUFDLE1BQU0sRUFBRSxJQUFJLEVBQUUsRUFBRSxJQUFJLElBQUksQ0FBQyxDQUFDLEVBQUUsT0FBTyxFQUFFLENBQUMsQ0FBQyxJQUFtQixFQUFFLEVBQUUsQ0FBQyxVQUFVLENBQUMsTUFBTSxFQUFFLElBQUksRUFBRSxFQUFFLEVBQUUsR0FBRyxDQUFDLENBQUMsQ0FBQztJQUNsSCxDQUFDO0lBRUQsSUFBSSxLQUFLLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxJQUFJLFVBQVUsQ0FBQyxNQUFNLENBQUMsRUFBRSxDQUFDO1FBQzlDLE9BQU8sQ0FBQyxHQUFHLE1BQU0sQ0FBQyxFQUFFLE9BQU8sRUFBRSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUMsVUFBVSxDQUFDLE1BQU0sRUFBRSxDQUFDLEVBQUUsRUFBRSxFQUFFLEdBQUcsQ0FBQyxDQUFDLENBQUM7SUFDNUUsQ0FBQztJQUVELElBQUksT0FBTyxNQUFNLElBQUksUUFBUSxJQUFJLE9BQU8sTUFBTSxJQUFJLFVBQVUsRUFBRSxDQUFDO1FBQzNELE9BQU8sQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxJQUFJLENBQUMsQ0FBQyxFQUFFLE9BQU8sRUFBRSxDQUFDLENBQUMsSUFBbUIsRUFBRSxFQUFFLENBQUMsVUFBVSxDQUFDLE1BQU0sRUFBRSxJQUFJLEVBQUUsRUFBRSxFQUFFLEdBQUcsQ0FBQyxDQUFDLENBQUM7SUFDckgsQ0FBQztBQUNMLENBQUMsQ0FBQTtBQUVELEVBQUU7QUFDRixNQUFNLENBQUMsTUFBTSxnQkFBZ0IsR0FBRyxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUMsRUFBRTtJQUNwQyxJQUFJLENBQUMsSUFBSSxJQUFJLElBQUksQ0FBQyxJQUFJLElBQUk7UUFBRSxPQUFPLEtBQUssQ0FBQztJQUN6QyxJQUFJLENBQUMsSUFBSSxJQUFJLElBQUksQ0FBQyxJQUFJLElBQUk7UUFBRSxPQUFPLElBQUksQ0FBQyxDQUFDLGFBQWE7SUFDdEQsSUFBSSxDQUFDLFlBQVksR0FBRyxJQUFJLENBQUMsWUFBWSxPQUFPLEVBQUUsQ0FBQztRQUFDLE9BQU8sQ0FBQyxDQUFDLElBQUksSUFBSSxDQUFDLENBQUMsSUFBSSxJQUFJLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLE9BQU8sRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFBQyxDQUFDLENBQUMsYUFBYTtJQUMzSyxJQUFJLENBQUMsWUFBWSxHQUFHLElBQUksQ0FBQyxZQUFZLE9BQU8sRUFBRSxDQUFDO1FBQUMsT0FBTyxDQUFDLENBQUMsSUFBSSxJQUFJLENBQUMsQ0FBQyxJQUFJLElBQUksS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsTUFBTSxFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQUMsQ0FBQyxDQUFDLGFBQWE7SUFDekksSUFBSSxLQUFLLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxJQUFJLEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQztRQUFDLE9BQU8sQ0FBQyxDQUFDLE1BQU0sSUFBSSxDQUFDLENBQUMsTUFBTSxJQUFJLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLFVBQVUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUFDLENBQUM7SUFDcEgsSUFBSSxPQUFPLENBQUMsSUFBSSxRQUFRLElBQUksT0FBTyxDQUFDLElBQUksUUFBUSxFQUFFLENBQUM7UUFBQyxPQUFPLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLElBQUksSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUFDLENBQUM7SUFDcEcsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDO0FBQ2xCLENBQUMsQ0FBQTtBQUVELEVBQUU7QUFDRixNQUFNLENBQUMsTUFBTSxVQUFVLEdBQUcsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFDLEVBQUU7SUFDOUIsSUFBSSxDQUFDLElBQUksSUFBSSxJQUFJLENBQUMsSUFBSSxJQUFJO1FBQUUsT0FBTyxLQUFLLENBQUM7SUFDekMsSUFBSSxDQUFDLElBQUksSUFBSSxJQUFJLENBQUMsSUFBSSxJQUFJO1FBQUUsT0FBTyxJQUFJLENBQUM7SUFDeEMsSUFBSSxPQUFPLENBQUMsSUFBSSxTQUFTLElBQUksT0FBTyxDQUFDLElBQUksU0FBUyxFQUFFLENBQUM7UUFDakQsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQ2xCLENBQUM7SUFDRCxJQUFJLE9BQU8sQ0FBQyxJQUFJLFFBQVEsSUFBSSxPQUFPLENBQUMsSUFBSSxRQUFRLEVBQUUsQ0FBQztRQUMvQyxPQUFPLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEdBQUcsSUFBSSxDQUFDLENBQUMsQ0FBQztJQUNqRCxDQUFDO0lBQ0QsSUFBSSxPQUFPLENBQUMsSUFBSSxR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SSxHQUFHLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsR0FBRyxFQUFFLEtBQUssQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLEdBQUcsRUFBRSxTQUFTLENBQUMsS0FBSyxFQUFFLEdBQUcsRUFBRSxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUNwSCxPQUFPLElBQUksR0FBRyxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLEdBQUcsRUFBRSxLQUFLLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQyxHQUFHLEVBQUUsbUJBQW1CLENBQUMsS0FBSyxFQUFFLFNBQVMsRUFBRSxDQUFDLEdBQUcsRUFBRSxHQUFHLENBQXlCLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUNwSSxDQUFDO0lBQ0QsSUFBSSxHQUFHLFlBQVksR0FBRyxFQUFFLENBQUM7UUFDckIsTUFBTSxPQUFPLEdBQUcsS0FBSyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsT0FBTyxFQUFFLENBQUMsQ0FBQztRQUMxQyxNQUFNLE1BQU0sR0FBRyxPQUFPLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxHQUFHLEVBQUUsS0FBSyxDQUFDLEVBQUUsRUFBRSxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQ3BELElBQUksT0FBTyxDQUFDLEtBQUssQ0FBQyxlQUFlLENBQUM7WUFBRSxPQUFPLElBQUksR0FBRyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQztRQUMxRSxPQUFPLElBQUksR0FBRyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLEVBQUUsQ0FBQyxtQkFBbUIsQ0FBQyxLQUFLLEVBQUUsU0FBUyxFQUFFLENBQUMsR0FBRyxFQUFFLEtBQUssQ0FBeUIsQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUNySCxDQUFDO0lBQ0QsSUFBSSxPQUFPLEdBQUcsSUFBSSxRQUFRLElBQUksQ0FBQyxHQUFHLEVBQUUsV0FBVyxJQUFJLE1BQU0sSUFBSSxNQUFNLENBQUMsU0FBUyxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLElBQUksaUJBQWlCLENBQUMsRUFBRSxDQUFDO1FBQ3JILE1BQU0sT0FBTyxHQUFHLEtBQUssQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO1FBQ2hELE1BQU0sTUFBTSxHQUFHLE9BQU8sQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLEdBQUcsRUFBRSxLQUFLLENBQUMsRUFBRSxFQUFFLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDcEQsSUFBSSxNQUFNLENBQUMsS0FBSyxDQUFDLGVBQWUsQ0FBQztZQUFFLE9BQU8sTUFBTSxDQUFDLFdBQVcsQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxHQUFHLEVBQUUsS0FBSyxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUMsR0FBRyxFQUFFLFNBQVMsQ0FBQyxLQUFLLEVBQUUsR0FBRyxFQUFFLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQy9ILE9BQU8sTUFBTSxDQUFDLFdBQVcsQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxHQUFHLEVBQUUsS0FBSyxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUMsR0FBRyxFQUFFLG1CQUFtQixDQUFDLEtBQUssRUFBRSxTQUFTLEVBQUUsQ0FBQyxHQUFHLEVBQUUsR0FBRyxDQUF5QixDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDL0ksQ0FBQztJQUNELE9BQU8sU0FBUyxDQUFDLEdBQUcsRUFBRSxLQUFLLEVBQUUsQ0FBQyxDQUFDLENBQUMsSUFBSSxFQUFFLEVBQUUsS0FBSyxFQUFFLENBQUMsQ0FBQyxDQUFDLElBQUksSUFBSSxDQUFDLENBQUM7QUFDaEUsQ0FBQyxDQUFBO0FBRUQsRUFBRTtBQUNGLE1BQU0sQ0FBQyxNQUFNLFNBQVMsR0FBRyxDQUFDLEVBQU8sRUFBRSxHQUFXLEVBQUUsS0FBVSxFQUFDLEVBQUU7SUFDekQsSUFBSSxFQUFFLEVBQUUsQ0FBQyxHQUFHLENBQUMsSUFBSSxJQUFJLEVBQUUsQ0FBQztRQUNwQixNQUFNLE1BQU0sR0FBRyxFQUFFLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDdkIsSUFBSSxLQUFLLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxFQUFFLENBQUM7WUFBQyxNQUFNLENBQUMsR0FBRyxDQUFDLEdBQUcsS0FBSyxDQUFDLENBQUM7UUFBQyxDQUFDO2FBQU0sSUFBSSxPQUFPLEtBQUssSUFBSSxVQUFVLEVBQUUsQ0FBQztZQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLENBQUM7UUFBQyxDQUFDO1FBQy9HLE9BQU8sRUFBRSxDQUFDO0lBQ2QsQ0FBQztJQUNELEVBQUUsQ0FBQyxHQUFHLENBQUMsS0FBSyxLQUFLLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLEdBQUcsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxPQUFPLEtBQUssSUFBSSxVQUFVLENBQUMsQ0FBQyxDQUFDLElBQUksR0FBRyxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUM7SUFDNUcsT0FBTyxFQUFFLENBQUM7QUFDZCxDQUFDLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBpc0Nhbkp1c3RSZXR1cm4gfSBmcm9tIFwiLi9QcmltaXRpdmVcIjtcblxuLy9cbmV4cG9ydCB0eXBlIFdlYWtLZXkgPSBvYmplY3QgfCBGdW5jdGlvbjtcbmV4cG9ydCB0eXBlIGtleVR5cGUgPSBzdHJpbmcgfCBudW1iZXIgfCBzeW1ib2w7XG5cbi8vXG5leHBvcnQgY29uc3QgaXNJdGVyYWJsZSA9IChvYmopID0+ICh0eXBlb2Ygb2JqPy5bU3ltYm9sLml0ZXJhdG9yXSA9PSBcImZ1bmN0aW9uXCIpO1xuZXhwb3J0IGNvbnN0IGlzS2V5VHlwZSAgPSAocHJvcDoga2V5VHlwZSB8IGFueSkgPT4gKFtcInN5bWJvbFwiLCBcInN0cmluZ1wiLCBcIm51bWJlclwiXS5pbmRleE9mKHR5cGVvZiBwcm9wKSA+PSAwKTtcbmV4cG9ydCBjb25zdCBpc1ZhbGlkT2JqID0gKG9iaj86IGFueSk9PiB7IHJldHVybiBvYmogIT0gbnVsbCAmJiAodHlwZW9mIG9iaiA9PSBcImZ1bmN0aW9uXCIgfHwgdHlwZW9mIG9iaiA9PSBcIm9iamVjdFwiKSAmJiAhKG9iaiBpbnN0YW5jZW9mIFdlYWtSZWYpOyB9O1xuZXhwb3J0IGNvbnN0IG1lcmdlQnlLZXkgPSAoaXRlbXM6IGFueVtdfFNldDxhbnk+LCBrZXkgPSBcImlkXCIpPT57XG4gICAgY29uc3QgZW50cmllcyA9IEFycmF5LmZyb20oaXRlbXM/LnZhbHVlcz8uKCkpLm1hcCgoSSk9PltJPy5ba2V5XSxJXSk7XG4gICAgY29uc3QgbWFwID0gbmV3IE1hcChlbnRyaWVzIGFzIGFueSk7XG4gICAgcmV0dXJuIEFycmF5LmZyb20obWFwPy52YWx1ZXM/LigpIHx8IFtdKTtcbn1cblxuLy9cbmV4cG9ydCBjb25zdCByZW1vdmVFeHRyYSA9ICh0YXJnZXQsIHZhbHVlLCBuYW1lOiBrZXlUeXBlIHwgbnVsbCA9IG51bGwpPT57XG4gICAgY29uc3QgZXhpc3RzID0gbmFtZSAhPSBudWxsICYmICh0eXBlb2YgdGFyZ2V0ID09IFwib2JqZWN0XCIgfHwgdHlwZW9mIHRhcmdldCA9PSBcImZ1bmN0aW9uXCIpID8gKHRhcmdldD8uW25hbWVdID8/IHRhcmdldCkgOiB0YXJnZXQ7IGxldCBlbnRyaWVzOiBhbnkgPSBbXTtcbiAgICBpZiAodmFsdWUgaW5zdGFuY2VvZiBTZXQgfHwgdmFsdWUgaW5zdGFuY2VvZiBNYXAgfHwgQXJyYXkuaXNBcnJheSh2YWx1ZSkgfHwgaXNJdGVyYWJsZSh2YWx1ZSkpIHsgZW50cmllcyA9ICgoZXhpc3RzIGluc3RhbmNlb2YgU2V0IHx8IGV4aXN0cyBpbnN0YW5jZW9mIFdlYWtTZXQpID8gdmFsdWU/LnZhbHVlcz8uKCkgOiB2YWx1ZT8uZW50cmllcz8uKCkpIHx8ICgoQXJyYXkuaXNBcnJheSh2YWx1ZSkgfHwgaXNJdGVyYWJsZSh2YWx1ZSkpID8gdmFsdWUgOiBbXSk7IH0gZWxzZVxuICAgIGlmICh0eXBlb2YgdmFsdWUgPT0gXCJvYmplY3RcIiB8fCB0eXBlb2YgdmFsdWUgPT0gXCJmdW5jdGlvblwiKSB7IGVudHJpZXMgPSAoZXhpc3RzIGluc3RhbmNlb2YgU2V0IHx8IGV4aXN0cyBpbnN0YW5jZW9mIFdlYWtTZXQpID8gT2JqZWN0LnZhbHVlcyh2YWx1ZSkgOiBPYmplY3QuZW50cmllcyh2YWx1ZSk7IH1cblxuICAgIC8vXG4gICAgbGV0IGV4RW50cmllczogYW55ID0gW107IGlmIChBcnJheS5pc0FycmF5KGV4aXN0cykpIHsgZXhFbnRyaWVzID0gZXhpc3RzLmVudHJpZXMoKTsgfSBlbHNlIC8vIEB0cy1pZ25vcmVcbiAgICBpZiAoZXhpc3RzIGluc3RhbmNlb2YgTWFwIHx8IGV4aXN0cyBpbnN0YW5jZW9mIFdlYWtNYXApIHsgZXhFbnRyaWVzID0gZXhpc3RzPy5lbnRyaWVzPy4oKTsgfSBlbHNlIC8vIEB0cy1pZ25vcmVcbiAgICBpZiAoZXhpc3RzIGluc3RhbmNlb2YgU2V0IHx8IGV4aXN0cyBpbnN0YW5jZW9mIFdlYWtTZXQpIHsgZXhFbnRyaWVzID0gZXhpc3RzPy52YWx1ZXM/LigpOyB9IGVsc2VcbiAgICBpZiAodHlwZW9mIGV4aXN0cyA9PSBcIm9iamVjdFwiIHx8IHR5cGVvZiBleGlzdHMgPT0gXCJmdW5jdGlvblwiKSB7IGV4RW50cmllcyA9IE9iamVjdC5lbnRyaWVzKGV4aXN0cyk7IH1cblxuICAgIC8vXG4gICAgY29uc3Qga2V5cyA9IG5ldyBTZXQoQXJyYXkuZnJvbShlbnRyaWVzKS5tYXAoKGUpPT5lPy5bMF0pKTtcbiAgICBjb25zdCBleGUgID0gbmV3IFNldChBcnJheS5mcm9tKGV4RW50cmllcykubWFwKChlKT0+ZT8uWzBdKSk7XG5cbiAgICAvLyBAdHMtaWdub3JlIC8vIFJFUVVJUkVTIE5FVyBFQ01BU0NSSVBUISEhXG4gICAgY29uc3QgZXhjbHVkZSA9IGtleXM/LmRpZmZlcmVuY2U/LihleGUpO1xuXG4gICAgLy9cbiAgICBpZiAoQXJyYXkuaXNBcnJheShleGlzdHMpKSB7IGNvbnN0IG53ID0gZXhpc3RzLmZpbHRlcigoXyxJKT0+IWV4Y2x1ZGUuaGFzKEkpKTsgZXhpc3RzLnNwbGljZSgwLCBleGlzdHMubGVuZ3RoKTsgZXhpc3RzLnB1c2goLi4ubncpOyB9IGVsc2VcbiAgICBpZiAoKGV4aXN0cyBpbnN0YW5jZW9mIE1hcCB8fCBleGlzdHMgaW5zdGFuY2VvZiBTZXQpIHx8IChleGlzdHMgaW5zdGFuY2VvZiBXZWFrTWFwIHx8IGV4aXN0cyBpbnN0YW5jZW9mIFdlYWtTZXQpKSB7IGZvciAoY29uc3QgayBvZiBleGNsdWRlKSB7IGV4aXN0cy5kZWxldGUoayk7IH07IH0gZWxzZVxuICAgIGlmICh0eXBlb2YgZXhpc3RzID09IFwiZnVuY3Rpb25cIiB8fCB0eXBlb2YgZXhpc3RzID09IFwib2JqZWN0XCIpIHsgZm9yIChjb25zdCBrIG9mIGV4Y2x1ZGUpIHsgZGVsZXRlIGV4aXN0c1trXTsgfTsgfTsgcmV0dXJuIGV4aXN0cztcbn1cblxuLy9cbmV4cG9ydCBjb25zdCBvYmplY3RBc3NpZ24gPSAodGFyZ2V0LCB2YWx1ZSwgbmFtZToga2V5VHlwZSB8IG51bGwgPSBudWxsLCByZW1vdmVOb3RFeGlzdHMgPSB0cnVlLCBtZXJnZUtleSA9IFwiaWRcIikgPT4ge1xuICAgIGNvbnN0IGV4aXN0cyA9IG5hbWUgIT0gbnVsbCAmJiAodHlwZW9mIHRhcmdldCA9PSBcIm9iamVjdFwiIHx8IHR5cGVvZiB0YXJnZXQgPT0gXCJmdW5jdGlvblwiKSA/ICh0YXJnZXQ/LltuYW1lXSA/PyB0YXJnZXQpIDogdGFyZ2V0O1xuICAgIGxldCBlbnRyaWVzOiBhbnkgPSBudWxsOyBpZiAocmVtb3ZlTm90RXhpc3RzKSB7IHJlbW92ZUV4dHJhKGV4aXN0cywgdmFsdWUpOyB9XG5cbiAgICAvL1xuICAgIGlmICh2YWx1ZSBpbnN0YW5jZW9mIFNldCB8fCB2YWx1ZSBpbnN0YW5jZW9mIE1hcCB8fCBBcnJheS5pc0FycmF5KHZhbHVlKSB8fCBpc0l0ZXJhYmxlKHZhbHVlKSkgeyBlbnRyaWVzID0gKChleGlzdHMgaW5zdGFuY2VvZiBTZXQgfHwgZXhpc3RzIGluc3RhbmNlb2YgV2Vha1NldCkgPyB2YWx1ZT8udmFsdWVzPy4oKSA6IHZhbHVlPy5lbnRyaWVzPy4oKSkgfHwgKChBcnJheS5pc0FycmF5KHZhbHVlKSB8fCBpc0l0ZXJhYmxlKHZhbHVlKSkgPyB2YWx1ZSA6IFtdKTsgfSBlbHNlXG4gICAgaWYgKHR5cGVvZiB2YWx1ZSA9PSBcIm9iamVjdFwiIHx8IHR5cGVvZiB2YWx1ZSA9PSBcImZ1bmN0aW9uXCIpIHsgZW50cmllcyA9IChleGlzdHMgaW5zdGFuY2VvZiBTZXQgfHwgZXhpc3RzIGluc3RhbmNlb2YgV2Vha1NldCkgPyBPYmplY3QudmFsdWVzKHZhbHVlKSA6IE9iamVjdC5lbnRyaWVzKHZhbHVlKTsgfVxuXG4gICAgLy9cbiAgICBpZiAoZXhpc3RzICYmIGVudHJpZXMgJiYgKHR5cGVvZiBlbnRyaWVzID09IFwib2JqZWN0XCIgfHwgdHlwZW9mIGVudHJpZXMgPT0gXCJmdW5jdGlvblwiKSkge1xuICAgICAgICBpZiAoZXhpc3RzIGluc3RhbmNlb2YgTWFwIHx8IGV4aXN0cyBpbnN0YW5jZW9mIFdlYWtNYXApIC8vIEB0cy1pZ25vcmVcbiAgICAgICAgICAgIHsgZm9yIChjb25zdCBFIG9mIGVudHJpZXMpIHsgZXhpc3RzLnNldCguLi5FKTsgfTsgcmV0dXJuIGV4aXN0czsgfVxuXG4gICAgICAgIC8vXG4gICAgICAgIGlmIChleGlzdHMgaW5zdGFuY2VvZiBTZXQgfHwgZXhpc3RzIGluc3RhbmNlb2YgV2Vha1NldClcbiAgICAgICAgICAgIHsgZm9yIChjb25zdCBFIG9mIGVudHJpZXMpIHsgLy8gQHRzLWlnbm9yZVxuICAgICAgICAgICAgICAgIGNvbnN0IG1lcmdlT2JqID0gRT8uW21lcmdlS2V5XSA/IEFycmF5LmZyb20oZXhpc3RzPy52YWx1ZXM/LigpIHx8IFtdKS5maW5kKChJKT0+IWlzTm90RXF1YWw/LihJPy5bbWVyZ2VLZXldLCBFPy5bbWVyZ2VLZXldKSkgOiBudWxsO1xuICAgICAgICAgICAgICAgIGlmIChtZXJnZU9iaiAhPSBudWxsKSB7IG9iamVjdEFzc2lnbihtZXJnZU9iaiwgRSwgbnVsbCwgcmVtb3ZlTm90RXhpc3RzLCBtZXJnZUtleSk7IH0gZWxzZSB7IGV4aXN0cy5hZGQoRSk7IH1cbiAgICAgICAgICAgIH0gcmV0dXJuIGV4aXN0czsgfVxuXG4gICAgICAgIC8vXG4gICAgICAgIGlmICh0eXBlb2YgZXhpc3RzID09IFwib2JqZWN0XCIgfHwgdHlwZW9mIGV4aXN0cyA9PSBcImZ1bmN0aW9uXCIpIHtcbiAgICAgICAgICAgIGlmIChBcnJheS5pc0FycmF5KGV4aXN0cykgfHwgaXNJdGVyYWJsZShleGlzdHMpKSB7XG4gICAgICAgICAgICAgICAgbGV0IEkgPSAwOyBmb3IgKGNvbnN0IEUgb2YgZW50cmllcylcbiAgICAgICAgICAgICAgICAgICAgeyBpZiAoSSA8IGV4aXN0cy5sZW5ndGgpIHsgZXhpc3RzW0krK10gPSBFPy5bMV07IH0gZWxzZSB7IGV4aXN0cz8ucHVzaD8uKEU/LlsxXSk7IH07IH1cbiAgICAgICAgICAgICAgICByZXR1cm4gZXhpc3RzO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIE9iamVjdC5hc3NpZ24oZXhpc3RzLCBPYmplY3QuZnJvbUVudHJpZXMoWy4uLihlbnRyaWVzfHxbXSldLmZpbHRlcigoSyk9Pih0eXBlb2YgSyAhPSBcInN5bWJvbFwiKSkpKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8vXG4gICAgaWYgKG5hbWUgIT0gbnVsbCkgeyBSZWZsZWN0LnNldCh0YXJnZXQsIG5hbWUsIHZhbHVlKTsgcmV0dXJuIHRhcmdldDsgfSBlbHNlXG4gICAgaWYgKHR5cGVvZiB2YWx1ZSA9PSBcIm9iamVjdFwiIHx8IHR5cGVvZiB2YWx1ZSA9PSBcImZ1bmN0aW9uXCIpXG4gICAgICAgIHsgcmV0dXJuIE9iamVjdC5hc3NpZ24odGFyZ2V0LCB2YWx1ZSk7IH07IHJldHVybiB2YWx1ZTtcbn1cblxuXG4vL1xuZXhwb3J0IGNvbnN0IGJpbmRGeCA9ICh0YXJnZXQsIGZ4KT0+e1xuICAgIC8vICFleHBlcmltZW50YWwgYGdldE9ySW5zZXJ0YCBmZWF0dXJlIVxuICAgIC8vIEB0cy1pZ25vcmVcbiAgICBjb25zdCBiZSA9IGJvdW5kQ3R4LmdldE9ySW5zZXJ0KHRhcmdldCwgbmV3IFdlYWtNYXAoKSk7XG4gICAgcmV0dXJuIGJlLmdldE9ySW5zZXJ0KGZ4LCBmeD8uYmluZD8uKHRhcmdldCkpO1xufVxuXG4vL1xuZXhwb3J0IGNvbnN0IGJpbmRDdHggICAgPSAodGFyZ2V0LCBmeCkgPT4gKCh0eXBlb2YgZnggPT0gXCJmdW5jdGlvblwiID8gYmluZEZ4KHRhcmdldCwgZngpIDogZngpID8/IGZ4KTtcblxuLy9cbmV4cG9ydCBjb25zdCBjYWxsQnlQcm9wID0gKHVud3JhcCwgcHJvcDoga2V5VHlwZSwgY2IsIGN0eCkgPT4ge1xuICAgIGlmIChwcm9wID09IFN5bWJvbC5pdGVyYXRvcikgeyByZXR1cm4gY2FsbEJ5QWxsUHJvcCh1bndyYXAsIGNiLCBjdHgpOyB9O1xuXG4gICAgLy9cbiAgICBpZiAoXG4gICAgICAgIHByb3AgPT0gbnVsbCB8fFxuICAgICAgICAvLyhwcm9wID09ICRleHRyYWN0S2V5JCB8fCBwcm9wID09ICRvcmlnaW5hbEtleSQgfHwgcHJvcCA9PSAkcmVnaXN0cnlLZXkkKSB8fFxuICAgICAgICAodHlwZW9mIHByb3AgPT0gXCJzeW1ib2xcIiB8fCB0eXBlb2YgcHJvcCA9PSBcIm9iamVjdFwiIHx8IHR5cGVvZiBwcm9wID09IFwiZnVuY3Rpb25cIilcbiAgICApIHJldHVybjtcblxuICAgIC8vXG4gICAgY29uc3QgY2FsbElmTm90TnVsbCA9ICh2LCAuLi5hcmdzKT0+e1xuICAgICAgICBpZiAodiAhPSBudWxsKSB7IHJldHVybiBjYj8uKHYsIC4uLmFyZ3MpOyB9XG4gICAgfVxuXG4gICAgLy9cbiAgICBpZiAodW53cmFwIGluc3RhbmNlb2YgTWFwIHx8IHVud3JhcCBpbnN0YW5jZW9mIFdlYWtNYXApIHtcbiAgICAgICAgaWYgKHVud3JhcC5oYXMocHJvcCBhcyBhbnkpKSB7IHJldHVybiBjYWxsSWZOb3ROdWxsPy4odW53cmFwLmdldChwcm9wIGFzIGFueSksIHByb3AsIG51bGwsIFwiQHNldFwiKTsgfVxuICAgIH0gZWxzZVxuICAgICAgICBpZiAodW53cmFwIGluc3RhbmNlb2YgU2V0IHx8IHVud3JhcCBpbnN0YW5jZW9mIFdlYWtTZXQpIHtcbiAgICAgICAgICAgIGlmICh1bndyYXAuaGFzKHByb3AgYXMgYW55KSkgeyByZXR1cm4gY2FsbElmTm90TnVsbD8uKHByb3AsIHByb3AsIG51bGwsIFwiQGFkZFwiKTsgfVxuICAgICAgICB9IGVsc2VcbiAgICAgICAgICAgIGlmIChBcnJheS5pc0FycmF5KHVud3JhcCkgJiYgKHR5cGVvZiBwcm9wID09IFwic3RyaW5nXCIgJiYgWy4uLnByb3A/Lm1hdGNoQWxsPy4oL15cXGQrJC9nKV0/Lmxlbmd0aCA9PSAxKSAmJiBOdW1iZXIuaXNJbnRlZ2VyKHR5cGVvZiBwcm9wID09IFwic3RyaW5nXCIgPyBwYXJzZUludChwcm9wKSA6IHByb3ApKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgaW5kZXggPSB0eXBlb2YgcHJvcCA9PSBcInN0cmluZ1wiID8gcGFyc2VJbnQocHJvcCkgOiBwcm9wO1xuICAgICAgICAgICAgICAgIHJldHVybiBjYWxsSWZOb3ROdWxsPy4odW53cmFwPy5baW5kZXhdLCBpbmRleCwgbnVsbCwgXCJAYWRkXCIpO1xuICAgICAgICAgICAgfSBlbHNlXG4gICAgICAgICAgICAgICAgaWYgKHR5cGVvZiB1bndyYXAgPT0gXCJmdW5jdGlvblwiIHx8IHR5cGVvZiB1bndyYXAgPT0gXCJvYmplY3RcIikgeyByZXR1cm4gY2FsbElmTm90TnVsbD8uKHVud3JhcD8uW3Byb3BdLCBwcm9wLCBudWxsLCBcIkBzZXRcIik7IH1cbn1cblxuLy9cbmV4cG9ydCBjb25zdCBvYmplY3RBc3NpZ25Ob3RFcXVhbCA9IChkc3QsIHNyYyA9IHt9KT0+eyBPYmplY3QuZW50cmllcyhzcmMpPy5mb3JFYWNoPy4oKFtrLHZdKT0+eyBpZiAoaXNOb3RFcXVhbCh2LCBkc3Rba10pKSB7IGRzdFtrXSA9IHY7IH07IH0pOyByZXR1cm4gZHN0OyB9XG5leHBvcnQgY29uc3QgY2FsbEJ5QWxsUHJvcCA9ICh1bndyYXAsIGNiLCBjdHgpPT57XG4gICAgaWYgKHVud3JhcCA9PSBudWxsKSByZXR1cm47XG5cbiAgICAvL1xuICAgIGxldCBrZXlzOiBhbnkgPSBbXTtcblxuICAgIGlmICh1bndyYXAgaW5zdGFuY2VvZiBTZXQgfHwgdW53cmFwIGluc3RhbmNlb2YgTWFwIHx8IHR5cGVvZiB1bndyYXA/LmtleXMgPT0gXCJmdW5jdGlvblwiKSB7XG4gICAgICAgIHJldHVybiBbLi4uKHVud3JhcD8ua2V5cz8uKCkgfHwga2V5cyldPy5mb3JFYWNoPy4oKHByb3A6IGtleVR5cGUgfCBhbnkpID0+IGNhbGxCeVByb3AodW53cmFwLCBwcm9wLCBjYiwgY3R4KSk7XG4gICAgfVxuXG4gICAgaWYgKEFycmF5LmlzQXJyYXkodW53cmFwKSB8fCBpc0l0ZXJhYmxlKHVud3JhcCkpIHtcbiAgICAgICAgcmV0dXJuIFsuLi51bndyYXBdPy5mb3JFYWNoPy4oKHYsIEkpID0+IGNhbGxCeVByb3AodW53cmFwLCBJLCBjYiwgY3R4KSk7XG4gICAgfVxuXG4gICAgaWYgKHR5cGVvZiB1bndyYXAgPT0gXCJvYmplY3RcIiB8fCB0eXBlb2YgdW53cmFwID09IFwiZnVuY3Rpb25cIikge1xuICAgICAgICByZXR1cm4gWy4uLihPYmplY3Qua2V5cyh1bndyYXApIHx8IGtleXMpXT8uZm9yRWFjaD8uKChwcm9wOiBrZXlUeXBlIHwgYW55KSA9PiBjYWxsQnlQcm9wKHVud3JhcCwgcHJvcCwgY2IsIGN0eCkpO1xuICAgIH1cbn1cblxuLy9cbmV4cG9ydCBjb25zdCBpc09iamVjdE5vdEVxdWFsID0gKGEsIGIpPT57XG4gICAgaWYgKGEgPT0gbnVsbCAmJiBiID09IG51bGwpIHJldHVybiBmYWxzZTtcbiAgICBpZiAoYSA9PSBudWxsIHx8IGIgPT0gbnVsbCkgcmV0dXJuIHRydWU7IC8vIEB0cy1pZ25vcmVcbiAgICBpZiAoYSBpbnN0YW5jZW9mIE1hcCB8fCBhIGluc3RhbmNlb2YgV2Vha01hcCkgeyByZXR1cm4gYS5zaXplICE9IGIuc2l6ZSB8fCBBcnJheS5mcm9tKGEuZW50cmllcygpKS5zb21lKChbaywgdl0pID0+ICFiLmhhcyhrKSB8fCAhaXNOb3RFcXVhbCh2LCBiLmdldChrKSkpOyB9IC8vIEB0cy1pZ25vcmVcbiAgICBpZiAoYSBpbnN0YW5jZW9mIFNldCB8fCBhIGluc3RhbmNlb2YgV2Vha1NldCkgeyByZXR1cm4gYS5zaXplICE9IGIuc2l6ZSB8fCBBcnJheS5mcm9tKGEudmFsdWVzKCkpLnNvbWUoKHYpID0+ICFiLmhhcyh2KSk7IH0gLy8gQHRzLWlnbm9yZVxuICAgIGlmIChBcnJheS5pc0FycmF5KGEpIHx8IEFycmF5LmlzQXJyYXkoYikpIHsgcmV0dXJuIGEubGVuZ3RoICE9IGIubGVuZ3RoIHx8IGEuc29tZSgodiwgaSkgPT4gIWlzTm90RXF1YWwodiwgYltpXSkpOyB9XG4gICAgaWYgKHR5cGVvZiBhID09IFwib2JqZWN0XCIgfHwgdHlwZW9mIGIgPT0gXCJvYmplY3RcIikgeyByZXR1cm4gSlNPTi5zdHJpbmdpZnkoYSkgIT0gSlNPTi5zdHJpbmdpZnkoYik7IH1cbiAgICByZXR1cm4gYSAhPSBiO1xufVxuXG4vL1xuZXhwb3J0IGNvbnN0IGlzTm90RXF1YWwgPSAoYSwgYik9PntcbiAgICBpZiAoYSA9PSBudWxsICYmIGIgPT0gbnVsbCkgcmV0dXJuIGZhbHNlO1xuICAgIGlmIChhID09IG51bGwgfHwgYiA9PSBudWxsKSByZXR1cm4gdHJ1ZTtcbiAgICBpZiAodHlwZW9mIGEgPT0gXCJib29sZWFuXCIgJiYgdHlwZW9mIGIgPT0gXCJib29sZWFuXCIpIHtcbiAgICAgICAgcmV0dXJuIGEgIT0gYjtcbiAgICB9XG4gICAgaWYgKHR5cGVvZiBhID09IFwibnVtYmVyXCIgJiYgdHlwZW9mIGIgPT0gXCJudW1iZXJcIikge1xuICAgICAgICByZXR1cm4gIShhID09IGIgfHwgKE1hdGguYWJzKGEgLSBiKSA8IDFlLTkpKTtcbiAgICB9XG4gICAgaWYgKHR5cGVvZiBhID09IFwic3RyaW5nXCIgJiYgdHlwZW9mIGIgPT0gXCJzdHJpbmdcIikge1xuICAgICAgICByZXR1cm4gKChhICE9IFwiXCIgJiYgYiAhPSBcIlwiKSAmJiBhICE9IGIpIHx8IGEgIT09IGI7XG4gICAgfVxuICAgIGlmICgodHlwZW9mIGEpICE9ICh0eXBlb2YgYikpIHtcbiAgICAgICAgcmV0dXJuIGEgIT09IGI7XG4gICAgfVxuICAgIHJldHVybiAoYSAmJiBiICYmIGEgIT0gYikgfHwgYSAhPT0gYjtcbn1cblxuLy9cbmV4cG9ydCBjb25zdCBib3VuZEN0eCAgPSBuZXcgV2Vha01hcCgpO1xuXG4vL1xuZXhwb3J0IGNvbnN0IGlzQXJyYXlJbnZhbGlkS2V5ID0gKGtleToga2V5VHlwZSB8IG51bGwgfCB1bmRlZmluZWQgfCBhbnksIHNyYz86IGFueSkgPT4ge1xuICAgIGNvbnN0IGludmFsaWRGb3JBcnJheSA9IGtleSA9PSBudWxsIHx8IChrZXkgYXMgYW55KSA8IDAgfHwgdHlwZW9mIGtleSAhPSBcIm51bWJlclwiIHx8IChrZXkgYXMgYW55KSA9PSBTeW1ib2wuaXRlcmF0b3IgfHwgKHNyYyAhPSBudWxsID8ga2V5ID49IChzcmM/Lmxlbmd0aCB8fCAwKSA6IGZhbHNlKTtcbiAgICByZXR1cm4gKHNyYyAhPSBudWxsID8gQXJyYXkuaXNBcnJheShzcmMpICYmIGludmFsaWRGb3JBcnJheSA6IGZhbHNlKTtcbn07XG5cbi8vXG5leHBvcnQgY29uc3QgaW5Qcm94eSA9IG5ldyBXZWFrTWFwKCk7XG5leHBvcnQgY29uc3QgY29udGV4dGlmeSA9IChwYzogYW55LCBuYW1lOiBhbnkpID0+IHsgcmV0dXJuICh0eXBlb2YgcGM/LltuYW1lXSA9PSBcImZ1bmN0aW9uXCIgPyBwYz8uW25hbWVdPy5iaW5kPy4ocGMpIDogcGM/LltuYW1lXSk7IH1cblxuLy9cbmV4cG9ydCBjb25zdCBkZWVwT3BlcmF0ZUFuZENsb25lID0gKG9iajogYW55LCBvcGVyYXRpb246IChlbDogYW55LCBrZXk6IG51bWJlcnxzdHJpbmcsIG9iajogYW55KT0+YW55LCAkcHJldj86IFthbnksIG51bWJlcnxzdHJpbmddfG51bGwpPT57XG4gICAgaWYgKEFycmF5LmlzQXJyYXkob2JqKSkge1xuICAgICAgICBpZiAob2JqLmV2ZXJ5KGlzQ2FuSnVzdFJldHVybikpIHJldHVybiBvYmoubWFwKG9wZXJhdGlvbik7XG4gICAgICAgIHJldHVybiBvYmoubWFwKCh2YWx1ZSwgaW5kZXgpID0+IGRlZXBPcGVyYXRlQW5kQ2xvbmUodmFsdWUsIG9wZXJhdGlvbiwgW29iaiwgaW5kZXhdIGFzIFthbnksIG51bWJlcnxzdHJpbmddKSk7XG4gICAgfVxuICAgIGlmIChvYmogaW5zdGFuY2VvZiBNYXApIHtcbiAgICAgICAgY29uc3QgZW50cmllcyA9IEFycmF5LmZyb20ob2JqLmVudHJpZXMoKSk7XG4gICAgICAgIGNvbnN0IHZhbHVlcyA9IGVudHJpZXMubWFwKChba2V5LCB2YWx1ZV0pID0+IHZhbHVlKTtcbiAgICAgICAgaWYgKHZhbHVlcy5ldmVyeShpc0Nhbkp1c3RSZXR1cm4pKSByZXR1cm4gbmV3IE1hcChlbnRyaWVzLm1hcCgoW2tleSwgdmFsdWVdKSA9PiBba2V5LCBvcGVyYXRpb24odmFsdWUsIGtleSwgb2JqKV0pKTtcbiAgICAgICAgcmV0dXJuIG5ldyBNYXAoZW50cmllcy5tYXAoKFtrZXksIHZhbHVlXSkgPT4gW2tleSwgZGVlcE9wZXJhdGVBbmRDbG9uZSh2YWx1ZSwgb3BlcmF0aW9uLCBbb2JqLCBrZXldIGFzIFthbnksIG51bWJlcnxzdHJpbmddKV0pKTtcbiAgICB9XG4gICAgaWYgKG9iaiBpbnN0YW5jZW9mIFNldCkge1xuICAgICAgICBjb25zdCBlbnRyaWVzID0gQXJyYXkuZnJvbShvYmouZW50cmllcygpKTtcbiAgICAgICAgY29uc3QgdmFsdWVzID0gZW50cmllcy5tYXAoKFtrZXksIHZhbHVlXSkgPT4gdmFsdWUpO1xuICAgICAgICBpZiAoZW50cmllcy5ldmVyeShpc0Nhbkp1c3RSZXR1cm4pKSByZXR1cm4gbmV3IFNldCh2YWx1ZXMubWFwKG9wZXJhdGlvbikpO1xuICAgICAgICByZXR1cm4gbmV3IFNldCh2YWx1ZXMubWFwKHZhbHVlID0+IGRlZXBPcGVyYXRlQW5kQ2xvbmUodmFsdWUsIG9wZXJhdGlvbiwgW29iaiwgdmFsdWVdIGFzIFthbnksIG51bWJlcnxzdHJpbmddKSkpO1xuICAgIH1cbiAgICBpZiAodHlwZW9mIG9iaiA9PSBcIm9iamVjdFwiICYmIChvYmo/LmNvbnN0cnVjdG9yID09IE9iamVjdCAmJiBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwob2JqKSA9PSBcIltvYmplY3QgT2JqZWN0XVwiKSkge1xuICAgICAgICBjb25zdCBlbnRyaWVzID0gQXJyYXkuZnJvbShPYmplY3QuZW50cmllcyhvYmopKTtcbiAgICAgICAgY29uc3QgdmFsdWVzID0gZW50cmllcy5tYXAoKFtrZXksIHZhbHVlXSkgPT4gdmFsdWUpO1xuICAgICAgICBpZiAodmFsdWVzLmV2ZXJ5KGlzQ2FuSnVzdFJldHVybikpIHJldHVybiBPYmplY3QuZnJvbUVudHJpZXMoZW50cmllcy5tYXAoKFtrZXksIHZhbHVlXSkgPT4gW2tleSwgb3BlcmF0aW9uKHZhbHVlLCBrZXksIG9iaildKSk7XG4gICAgICAgIHJldHVybiBPYmplY3QuZnJvbUVudHJpZXMoZW50cmllcy5tYXAoKFtrZXksIHZhbHVlXSkgPT4gW2tleSwgZGVlcE9wZXJhdGVBbmRDbG9uZSh2YWx1ZSwgb3BlcmF0aW9uLCBbb2JqLCBrZXldIGFzIFthbnksIG51bWJlcnxzdHJpbmddKV0pKTtcbiAgICB9XG4gICAgcmV0dXJuIG9wZXJhdGlvbihvYmosICRwcmV2Py5bMV0gPz8gXCJcIiwgJHByZXY/LlswXSA/PyBudWxsKTtcbn1cblxuLy9cbmV4cG9ydCBjb25zdCBiaW5kRXZlbnQgPSAob246IGFueSwga2V5OiBzdHJpbmcsIHZhbHVlOiBhbnkpPT57XG4gICAgaWYgKG9uPy5ba2V5XSAhPSBudWxsKSB7XG4gICAgICAgIGNvbnN0IGV4aXN0cyA9IG9uW2tleV07XG4gICAgICAgIGlmIChBcnJheS5pc0FycmF5KHZhbHVlKSkgeyBleGlzdHMuYWRkKC4uLnZhbHVlKTsgfSBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT0gXCJmdW5jdGlvblwiKSB7IGV4aXN0cy5hZGQodmFsdWUpOyB9XG4gICAgICAgIHJldHVybiBvbjtcbiAgICB9XG4gICAgb25ba2V5XSA/Pz0gQXJyYXkuaXNBcnJheSh2YWx1ZSkgPyBuZXcgU2V0KHZhbHVlKSA6ICh0eXBlb2YgdmFsdWUgPT0gXCJmdW5jdGlvblwiID8gbmV3IFNldChbdmFsdWVdKSA6IHZhbHVlKTtcbiAgICByZXR1cm4gb247XG59XG4iXX0=